# Implementation Plan: Browsing & On-Demand Loading

**Branch**: `002-browsing-on-demand` | **Date**: 2025-12-07 | **Spec**: [specs/002-browsing-on-demand/spec.md](specs/002-browsing-on-demand/spec.md)
**Input**: Feature specification from `/specs/002-browsing-on-demand/spec.md`

## Summary

Implement infinite scrolling for the Pokemon grid using `react-virtuoso` and offline-capable image caching using `vite-plugin-pwa` (Workbox). The system will cache PokeAPI images on demand (Cache-First strategy) and serve them from the Service Worker in subsequent requests or offline mode.

## Technical Context

**Language/Version**: TypeScript 5.9+
**Primary Dependencies**: 
- React 19
- Chakra UI v3 (UI components)
- `react-virtuoso` (New: for virtualized scrolling)
- `vite-plugin-pwa` (New: for Service Worker generation)
**Storage**: 
- Browser Cache Storage API (via Workbox) for images
- localStorage (existing) for application state
**Testing**: Vitest, React Testing Library
**Target Platform**: Web (PWA)
**Performance Goals**: 
- 60fps scrolling
- <100ms initial render
- Zero network usage for cached images
**Constraints**: 
- Offline-first for images
- Must handle external image domain (raw.githubusercontent.com)
**Scale/Scope**: 1025 Pokemon items in a single grid

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- [x] **Code Quality**: Will follow linting and formatting rules.
- [x] **Testing**: TDD will be used. Unit tests for components, integration tests for SW (if possible via browser tests) or mocked SW.
- [x] **UX**: Consistent with Chakra UI. Loading states (skeletons) required.
- [x] **Velocity**: Using established libraries (`react-virtuoso`, `workbox`) to speed up implementation.
- [x] **Dependencies**: Adding `react-virtuoso` and `vite-plugin-pwa` is necessary for the feature requirements (performance and offline capability).

## Project Structure

### Documentation (this feature)

```text
specs/002-browsing-on-demand/
├── plan.md              # This file
├── research.md          # Phase 0 output
├── data-model.md        # Phase 1 output
├── quickstart.md        # Phase 1 output
├── contracts/           # Phase 1 output
└── tasks.md             # Phase 2 output
```

### Source Code (repository root)

```text
src/
├── components/
│   ├── LazyLoadingGrid.tsx  # New: Virtualized grid wrapper
│   └── PokemonCard.tsx      # Update: Image loading handling
├── hooks/
│   └── usePokemonIndex.ts   # Existing: Data source
└── sw.js                    # Generated by vite-plugin-pwa (virtual)

vite.config.ts               # Update: Add PWA plugin config
```

**Structure Decision**: Option 1: Single project (DEFAULT)

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| [e.g., 4th project] | [current need] | [why 3 projects insufficient] |
| [e.g., Repository pattern] | [specific problem] | [why direct DB access insufficient] |
